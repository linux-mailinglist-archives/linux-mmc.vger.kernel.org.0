Return-Path: <linux-mmc-owner@vger.kernel.org>
X-Original-To: lists+linux-mmc@lfdr.de
Delivered-To: lists+linux-mmc@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id C79AC23FF00
	for <lists+linux-mmc@lfdr.de>; Sun,  9 Aug 2020 17:21:57 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726200AbgHIPVu (ORCPT <rfc822;lists+linux-mmc@lfdr.de>);
        Sun, 9 Aug 2020 11:21:50 -0400
Received: from mail2-relais-roc.national.inria.fr ([192.134.164.83]:34067 "EHLO
        mail2-relais-roc.national.inria.fr" rhost-flags-OK-OK-OK-OK)
        by vger.kernel.org with ESMTP id S1726175AbgHIPVt (ORCPT
        <rfc822;linux-mmc@vger.kernel.org>); Sun, 9 Aug 2020 11:21:49 -0400
X-IronPort-AV: E=Sophos;i="5.75,454,1589234400"; 
   d="scan'208";a="462926077"
Received: from abo-173-121-68.mrs.modulonet.fr (HELO hadrien) ([85.68.121.173])
  by mail2-relais-roc.national.inria.fr with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384; 09 Aug 2020 17:21:37 +0200
Date:   Sun, 9 Aug 2020 17:21:37 +0200 (CEST)
From:   Julia Lawall <julia.lawall@inria.fr>
X-X-Sender: jll@hadrien
To:     Tomas Winkler <tomas.winkler@intel.com>
cc:     kbuild-all@lists.01.org, Zhou Furong <furong.zhou@intel.com>,
        Alexander Usyskin <alexander.usyskin@intel.com>,
        Ulf Hansson <ulf.hansson@linaro.org>,
        linux-mmc@vger.kernel.org, linux-kernel@vger.kernel.org
Subject: [PATCH] mmc: block: fix memdup.cocci warnings
Message-ID: <alpine.DEB.2.22.394.2008091720080.2450@hadrien>
User-Agent: Alpine 2.22 (DEB 394 2020-01-19)
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Sender: linux-mmc-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-mmc.vger.kernel.org>
X-Mailing-List: linux-mmc@vger.kernel.org

From: kernel test robot <lkp@intel.com>

 Use kmemdup rather than duplicating its implementation

Generated by: scripts/coccinelle/api/memdup.cocci

Fixes: 68083eebfb0a ("mmc: block: register RPMB partition with the RPMB subsystem")
CC: Tomas Winkler <tomas.winkler@intel.com>
Signed-off-by: kernel test robot <lkp@intel.com>
Signed-off-by: Julia Lawall <julia.lawall@inria.fr>
---

tree:   https://github.com/intel/linux-intel-lts.git 5.4/preempt-rt
head:   64f494c08613ebb24a83b69223e7f90e8b7ce956
commit: 68083eebfb0a008e9bec30cefb2260f0543ed5ec [97/9103] mmc: block: register RPMB partition with the RPMB subsystem
:::::: branch date: 4 days ago
:::::: commit date: 9 months ago

 block.c |    3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

--- a/drivers/mmc/core/block.c
+++ b/drivers/mmc/core/block.c
@@ -1270,11 +1270,10 @@ static int mmc_blk_rpmb_set_dev_id(struc
 {
 	char *id;

-	id = kmalloc(sizeof(card->raw_cid), GFP_KERNEL);
+	id = kmemdup(card->raw_cid, sizeof(card->raw_cid), GFP_KERNEL);
 	if (!id)
 		return -ENOMEM;

-	memcpy(id, card->raw_cid, sizeof(card->raw_cid));
 	ops->dev_id = id;
 	ops->dev_id_len = sizeof(card->raw_cid);

